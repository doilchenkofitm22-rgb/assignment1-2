 # Модель загроз (STRIDE)

## Контекст

Цей проєкт — публічний Flask‑вебдодаток, що використовує SQLite для зберігання користувачів і постів. Додаток навмисно містить уразливості (SQL‑інʼєкція, відображена XSS, слабке зберігання паролів) для демонстрації процесу інтеграції безпеки. В системі запроваджено модель розробки DevSecOps, тобто автоматизовані перевірки коду (SAST/DAST) виконуються на кожному етапі CI/CD.

## STRIDE‑матриця

- **Spoofing (Підміна):** можливість підміни облікових даних через відсутність захищених session cookie (немає флагів `Secure`/`HttpOnly`).
- **Tampering (Модифікація):** SQL‑інʼєкції дозволяють змінювати дані в БД;
- **Repudiation (Відмова від дій):** журналювання входів не реалізовано, тому важко довести факт компрометації;
- **Information Disclosure (Розкриття інформації):** XSS може використовуватись для крадіжки cookie; неправильне управління секретами призводить до їхнього витоку;
- **Denial of Service (Відмова в обслуговуванні):** складні пошукові запити можуть призвести до блокування сервісу;
- **Elevation of Privilege (Підвищення прав):** слабкі перевірки ролей можуть дати доступ до прихованих сторінок.

## Сценарії атак

1. **SQL‑інʼєкція у `/search`**
   *Вектор:* параметр `q` вставляється безпосередньо в SQL‑запит. Зловмисник може інʼєктувати умови на оновлення чи видалення.  
   *Виявлення:* статичні аналізатори Semgrep/Bandit знаходять небезпечні форматування SQL; ZAP та інші DAST утиліти виявляють відхилення в результатах запиту.  
   *Помʼякшення:* використання параметризованих запитів (`?`), ORM, валідація параметрів.

2. **Reflected XSS на `/echo`**
   *Вектор:* параметр `msg` відображається у відповідь без екранування. Зловмисник може вставити JavaScript, що вкраде cookie або проведе фішинг.  
   *Виявлення:* інструменти DAST (OWASP ZAP) автоматично тестують інʼєкції JavaScript; ручне тестування через браузер.  
   *Помʼякшення:* екранування виводу (`escape`), заголовки CSP, перевірка введених даних.

3. **Слабка автентифікація на `/login`**
   *Вектор:* паролі зберігаються у відкритому вигляді, немає обмеження на кількість спроб, немає складних вимог до пароля.  
   *Виявлення:* SAST знаходить відсутність хешування; аудит бази показує plaintext паролі; лог‑аналіз дозволяє виявити підозрілий підбір паролів.  
   *Помʼякшення:* використання стійких хешів (PBKDF2, Argon2), salt; rate limiting і блокування; двофакторна автентифікація.

## Виявлені ризики / знахідки

- **R1 SQLi:** Semgrep виявив використання форматованих рядків при формуванні SQL; ZAP показав, що передача `' OR 1=1--` повертає всі записи. Потребує виправлення.
- **R2 XSS:** ZAP baseline виявив відсутність заголовків `Content-Security-Policy` та можливість відображеної XSS у `/echo`.  
- **R3 Weak auth:** Bandit повідомив про зберігання паролів у відкритому вигляді; немає обмежень на спроби входу.  
- **R4 Missing security headers:** у відповідях відсутні заголовки `X-Content-Type-Options` та `X-Frame-Options`, що підвищує ризик clickjacking та MIME‑sniffing.

 
